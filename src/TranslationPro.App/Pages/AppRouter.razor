@page "/redirect/{ApplicationId:guid}"
@page "/redirect"
@using TranslationPro.Shared.Interfaces
@using Solutaris.InfoWARE.ProtectedBrowserStorage.Services
@using TranslationPro.Shared.Models

@code {

    [Parameter]
    public Guid ApplicationId { get; set; }

    public NavigationManager NavigationManager { get; set; }

    [Inject]
    public IApplicationsController ApplicationService { get; set; }

    [Inject]
    public IIWLocalStorageService LocalStorage { get; set; }

    private List<ApplicationOutput> Applications { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        Applications = await ApplicationService.GetApplicationsAsync();
        if (Applications == null || Applications.Count == 0)
        {
            NavigationManager.NavigateTo("/applications/create");
        }
        else
        {
            if (Applications.Select(x => x.Id).Contains(ApplicationId))
            {
                await LocalStorage.SetItemAsync("ApplicationId", ApplicationId);
                NavigationManager.NavigateTo($"/application/{ApplicationId}");
            }
        }
    }

}
