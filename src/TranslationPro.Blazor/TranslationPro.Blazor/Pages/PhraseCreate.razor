@page "/applications/{ApplicationId:guid}/create-phrase"
@using TranslationPro.Shared.Interfaces
@using TranslationPro.Blazor.Services
@inherits ApplicationDetailsBase

<Row>
    <Column ColumnSize="ColumnSize.Is6.OnDesktop">
        <Card Margin="Margin.Is4.FromBottom">
            <CardHeader>
                <CardTitle>Basic Example</CardTitle>
            </CardHeader>
            <CardBody>
                <Validations Mode="ValidationMode.Auto" ValidateOnLoad="false">
                    
                    @for (var index = 0; index < Phrases.Count; index++)
                    {
                        var local = index;
                        <Validation Validator="@ValidationRule.IsNotEmpty">
                            <Field>
                                <FieldLabel>Enter Phrase</FieldLabel>
                                <TextEdit @bind-Text="@Phrases[local].Value"/>
                            </Field>
                        </Validation>
                    }

                    <Button Color="Color.Primary" Clicked="HandleSubmit">Submit</Button>
                </Validations>

            </CardBody>
        </Card>
    </Column>
</Row>
@code {

    [Inject]
    public IApplicationPhrasesController ApplicationPhraseProxy { get; set; }

    private readonly List<FormResponse> Phrases = new List<FormResponse>()
    {
        new FormResponse(){ Value = "" }
    };


    protected override async Task LoadData()
    {
        await base.LoadData();

        NavigationItems.Add(new NavigationItem()
            {
                Title = "Create Phrase"
            });
    }




    private async Task HandleSubmit(MouseEventArgs evnt)
    {
        var cleanItems = Phrases.Select(x => x.Value).ToList();

        var phraseOptions = new ApplicationPhrasesCreateOptions
            {
                Texts = cleanItems
            };
        var result = await ApplicationPhraseProxy.CreatePhrasesAsync(ApplicationId, phraseOptions);
        if (result != null)
        {
            NavigationManager.NavigateTo($"/applications/{ApplicationId}");
        }
    }
}